// [NEXUS IDENTITY] ID: 7187611831082939116 | DATE: 2025-11-19

// Тесты для MCP инструментов
// Формат: YAxUnit
// Проверка работы MCP сервера и инструментов

#Область Тесты_MCPИнструменты

// Тест: MCP инструмент поиска метаданных
Процедура Тест_MCPИнструмент_ПоискМетаданных() Экспорт
    
    // Arrange (подготовка)
    Запрос = "Справочник.Пользователи";
    
    // Act (действие)
    Результат = MCPИнструменты.ПоискМетаданных(Запрос);
    
    // Assert (проверка через YAxUnit)
    ЮТест.ОжидаетЧто(Результат, "Результат поиска метаданных")
        .Заполнено()
        .ИмеетСвойство("metadata")
        .ИмеетСвойство("functions");
    
    // Проверка структуры результата
    УсловиеПоиска = ЮТест.Предикат()
        .Реквизит("type").Равно("Справочник")
        .И().Реквизит("name").Равно("Пользователи")
        .Получить();
    
    ЮТест.ОжидаетЧто(Результат.metadata, "Метаданные справочника")
        .СодержитЭлемент(УсловиеПоиска);
    
КонецПроцедуры

// Тест: MCP инструмент семантического поиска
Процедура Тест_MCPИнструмент_СемантическийПоиск() Экспорт
    
    // Arrange (подготовка)
    Запрос = "Как работать с пользователями?";
    
    // Act (действие)
    Результат = MCPИнструменты.СемантическийПоиск(Запрос);
    
    // Assert (проверка через YAxUnit)
    ЮТест.ОжидаетЧто(Результат, "Результат семантического поиска")
        .Заполнено()
        .ИмеетСвойство("results");
    
    ЮТест.ОжидаетЧто(Результат.results, "Список результатов")
        .ИмеетДлинуБольше(0);
    
    // Проверка релевантности результатов
    Для Каждого Результат Поиска Из Результат.results Цикл
        ЮТест.ОжидаетЧто(РезультатПоиска, "Результат поиска")
            .ИмеетСвойство("score")
            .ИмеетСвойство("code");
        
        ЮТест.ОжидаетЧто(РезультатПоиска.score, "Оценка релевантности")
            .Больше(0.5); // Минимальная релевантность
    КонецЦикла;
    
КонецПроцедуры

// Тест: MCP инструмент генерации кода
Процедура Тест_MCPИнструмент_ГенерацияКода() Экспорт
    
    // Arrange (подготовка)
    Запрос = "Создай функцию для расчета скидки";
    
    // Act (действие)
    Результат = MCPИнструменты.ГенерироватьКод(Запрос);
    
    // Assert (проверка через YAxUnit)
    ЮТест.ОжидаетЧто(Результат, "Результат генерации кода")
        .Заполнено()
        .ИмеетСвойство("code");
    
    ЮТест.ОжидаетЧто(Результат.code, "Сгенерированный код")
        .Заполнено()
        .ИмеетДлинуБольше(0)
        .Содержит("Функция"); // Код должен содержать функцию
    
КонецПроцедуры

#КонецОбласти

