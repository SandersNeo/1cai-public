// [NEXUS IDENTITY] ID: -4683340651764998564 | DATE: 2025-11-19

// Тесты для парсеров BSL и метаданных 1С
// Формат: YAxUnit
// Проверка корректности парсинга конфигураций 1С

#Область Тесты_Парсеры

// Тест: Парсинг метаданных справочника
Процедура Тест_ПарсерМетаданных_Справочник() Экспорт
    
    // Arrange (подготовка)
    ПутьККонфигурации = "ТестоваяКонфигурация";
    
    // Act (действие)
    РезультатПарсинга = ПарсерМетаданных.Разобрать(ПутьККонфигурации);
    
    // Assert (проверка через YAxUnit)
    ЮТест.ОжидаетЧто(РезультатПарсинга, "Результат парсинга")
        .Заполнено()
        .ИмеетСвойство("Метаданные")
        .ИмеетСвойство("Модули");
    
    // Проверка наличия справочника "Пользователи"
    УсловиеПоиска = ЮТест.Предикат()
        .Реквизит("Тип").Равно("Справочник")
        .И().Реквизит("Имя").Равно("Пользователи")
        .Получить();
    
    ЮТест.ОжидаетЧто(РезультатПарсинга.Метаданные, "Метаданные конфигурации")
        .СодержитЭлемент(УсловиеПоиска);
    
КонецПроцедуры

// Тест: Синхронизация парсера с PostgreSQL
Процедура Тест_Парсер_СинхронизацияСPostgreSQL() Экспорт
    
    // Arrange (подготовка)
    Конфигурация = "Бухгалтерия 3.0";
    
    // Act (действие)
    Метаданные = ПарсерМетаданных.Разобрать(Конфигурация);
    PostgreSQLКлиент.Сохранить(Метаданные);
    
    // Assert (проверка базы данных через YAxUnit)
    УсловиеПоиска = ЮТест.Предикат()
        .Реквизит("name").Равно(Конфигурация)
        .Получить();
    
    ЮТест.ОжидаетЧтоТаблицаБазы("configurations", "Конфигурация сохранена в PostgreSQL")
        .СодержитЗапись(УсловиеПоиска);
    
КонецПроцедуры

// Тест: Парсинг модулей BSL
Процедура Тест_Парсер_МодулиBSL() Экспорт
    
    // Arrange (подготовка)
    КодМодуля = "Функция Тест()\n    Возврат 123;\nКонецФункции";
    
    // Act (действие)
    Результат = ПарсерBSL.Разобрать(КодМодуля);
    
    // Assert (проверка через YAxUnit)
    ЮТест.ОжидаетЧто(Результат, "Результат парсинга BSL")
        .Заполнено()
        .ИмеетСвойство("Функции");
    
    ЮТест.ОжидаетЧто(Результат.Функции, "Список функций")
        .ИмеетДлину(1)
        .СодержитЭлемент(ЮТест.Предикат()
            .Реквизит("Имя").Равно("Тест")
            .И().Реквизит("ТипВозвращаемогоЗначения").Равно("Число")
        );
    
КонецПроцедуры

#КонецОбласти

