// [NEXUS IDENTITY] ID: 2826754384224915075 | DATE: 2025-11-19

﻿// Модуль: М1сAIТаблицыЗначений
// Назначение: Модуль работы с таблицами значений
//
////////////////////////////////////////////////////////////////////////////////


#Область ПубличныйИнтерфейс

// <doc>
//   <summary>Создает таблицу значений с колонками и опциональными строками данных.</summary> ✦
//   <param i="1" name="КолонкиИТипы" type="String,Structure">Строка вида "Колонка1:Тип1,Колонка2:Тип2" или структура с колонками и типами</param> ➤
//   <param i="2" name="Строки" type="Array">Массив структур или массивов со значениями строк (необязательно)</param> ➤
//   <returns>ValueTable — новая таблица значений</returns> ⬅
//   <complexity cc="4"/>
//   <example>
//     // М1сAIТаблицыЗначений.Of("Имя:Строка,Возраст:Число", М1сAIМассивы.Of(М1сAIСтруктуры.Of("Имя", "Иван", "Возраст", 30)))
//     // М1сAIТаблицыЗначений.Of("Код,Наименование,Цена:Число")
//     // М1сAIТаблицыЗначений.Of(М1сAIСтруктуры.Of("Товар", "Строка", "Количество", "Число"))
//   </example>
// </doc>
Функция Of(КолонкиИТипы, Строки = Неопределено) Экспорт   //⚙
	
	ib = "Создание таблицы с колонками и строками";   //✍
	
	Таблица = Новый ТаблицаЗначений;   //✏
	
	// Добавляем колонки
	Если ТипЗнч(КолонкиИТипы) = Тип("Строка") Тогда   //⚡
		ДобавитьКолонкиИзСтроки(Таблица, КолонкиИТипы);   //▶️
	ИначеЕсли ТипЗнч(КолонкиИТипы) = Тип("Структура") Тогда   //⚡
		ДобавитьКолонкиИзСтруктуры(Таблица, КолонкиИТипы);   //▶️
	КонецЕсли;
	
	// Добавляем строки если переданы
	Если ТипЗнч(Строки) = Тип("Массив") Тогда   //⚡
		Для Каждого ДанныеСтроки Из Строки Цикл   //⟳
			ДобавитьСтрокуВТаблицу(Таблица, ДанныеСтроки);   //▶️
		КонецЦикла;
	КонецЕсли;
	
	Возврат Таблица;   //↩
	
КонецФункции

// <doc>
//   <summary>Создает пустую таблицу только с колонками без строк.</summary> ✦
//   <param i="1" name="КолонкиИТипы" type="String,Structure">Определение колонок</param> ➤
//   <returns>ValueTable — таблица значений без строк</returns> ⬅
//   <complexity cc="2"/>
//   <example>
//     // М1сAIТаблицыЗначений.OfColumns("Код:Строка,Наименование:Строка,Цена:Число")
//   </example>
// </doc>
Функция OfColumns(КолонкиИТипы) Экспорт   //⚙
	
	ib = "Создание таблицы только с колонками";   //✍
	
	Возврат Of(КолонкиИТипы);   //▶️
	
КонецФункции

// <doc>
//   <summary>Добавляет новую строку в таблицу и заполняет её значениями.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Целевая таблица</param> ➤
//   <param i="2" name="ЗначенияСтроки" type="Structure,Array">Структура или массив значений для новой строки</param> ➤
//   <returns>ValueTableRow — добавленная строка</returns> ⬅
//   <complexity cc="3"/>
//   <example>
//     // таблица = М1сAIТаблицыЗначений.OfColumns("Товар,Количество:Число");
//     // М1сAIТаблицыЗначений.AddRow(таблица, М1сAIСтруктуры.Of("Товар", "Молоко", "Количество", 5));
//   </example>
// </doc>
Функция AddRow(Таблица, ЗначенияСтроки) Экспорт   //⚙
	
	ib = "Добавление строки в таблицу";   //✍
	
	НоваяСтрока = Таблица.Добавить();   //✏
	
	Если ТипЗнч(ЗначенияСтроки) = Тип("Структура") Тогда   //⚡
		ЗаполнитьЗначенияСвойств(НоваяСтрока, ЗначенияСтроки);   //✏
	ИначеЕсли ТипЗнч(ЗначенияСтроки) = Тип("Массив") Тогда   //⚡
		ЗаполнитьСтрокуИзМассива(НоваяСтрока, ЗначенияСтроки);   //▶️
	КонецЕсли;
	
	Возврат НоваяСтрока;   //↩
	
КонецФункции

// <doc>
//   <summary>Добавляет несколько строк в таблицу из массива.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Целевая таблица</param> ➤
//   <param i="2" name="МассивСтрок" type="Array">Массив структур или массивов со значениями</param> ➤
//   <returns>Number — количество добавленных строк</returns> ⬅
//   <complexity cc="2"/>
// </doc>
Функция AddRows(Таблица, МассивСтрок) Экспорт   //⚙
	
	ib = "Добавление нескольких строк";   //✍
	
	Счетчик = 0;   //✏
	
	Для Каждого ДанныеСтроки Из МассивСтрок Цикл   //⟳
		AddRow(Таблица, ДанныеСтроки);   //▶️
		Счетчик = Счетчик + 1;   //✏
	КонецЦикла;
	
	Возврат Счетчик;   //↩
	
КонецФункции

// <doc>
//   <summary>Находит первую строку таблицы по значениям колонок.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для поиска</param> ➤
//   <param i="2" name="КолонкиИЗначения" type="Structure">Структура вида {Колонка: Значение} для поиска</param> ➤
//   <returns>ValueTableRow,Undefined — найденная строка или Неопределено</returns> ⬅
//   <complexity cc="2"/>
//   <example>
//     // строка = М1сAIТаблицыЗначений.FindRow(таблица, М1сAIСтруктуры.Of("Код", "001"));
//   </example>
// </doc>
Функция FindRow(Таблица, КолонкиИЗначения) Экспорт   //⚙
	
	ib = "Поиск строки в таблице";   //✍
	
	НайденныеСтроки = Таблица.НайтиСтроки(КолонкиИЗначения);   //✏
	
	Если НайденныеСтроки.Количество() > 0 Тогда   //⚡
		Возврат НайденныеСтроки[0];   //↩
	Иначе
		Возврат Неопределено;   //↩
	КонецЕсли;
	
КонецФункции

// <doc>
//   <summary>Находит все строки таблицы по значениям колонок.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для поиска</param> ➤
//   <param i="2" name="КолонкиИЗначения" type="Structure">Структура для поиска или Неопределено для всех строк</param> ➤
//   <returns>Array — массив найденных строк</returns> ⬅
//   <complexity cc="2"/>
//   <example>
//     // строки = М1сAIТаблицыЗначений.Filter(таблица, М1сAIСтруктуры.Of("Активен", Истина));
//   </example>
// </doc>
Функция Filter(Таблица, КолонкиИЗначения = Неопределено) Экспорт   //⚙
	
	ib = "Фильтрация строк таблицы";   //✍
	
	Если КолонкиИЗначения = Неопределено Тогда   //⚡
		Возврат ТаблицаВМассив(Таблица);   //▶️
	Иначе
		Возврат Таблица.НайтиСтроки(КолонкиИЗначения);   //↩
	КонецЕсли;
	
КонецФункции

// <doc>
//   <summary>Сортирует таблицу по указанным колонкам.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для сортировки</param> ➤
//   <param i="2" name="Колонки" type="String">Строка с колонками для сортировки, через запятую (можно "Убыв")</param> ➤
//   <returns>ValueTable — исходная таблица (изменяется)</returns> ⬅
//   <complexity cc="1"/>
//   <example>
//     // М1сAIТаблицыЗначений.Sort(таблица, "Цена Убыв, Наименование");
//   </example>
// </doc>
Функция Sort(Таблица, Колонки) Экспорт   //⚙
	
	ib = "Сортировка таблицы";   //✍
	
	Таблица.Сортировать(Колонки);   //✏
	
	Возврат Таблица;   //↩
	
КонецФункции

// <doc>
//   <summary>Преобразует таблицу в массив структур.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Исходная таблица</param> ➤
//   <param i="2" name="Колонки" type="String">Список колонок через запятую (пусто = все колонки)</param> ➤
//   <returns>Array — массив структур</returns> ⬅
//   <complexity cc="3"/>
//   <example>
//     // массив = М1сAIТаблицыЗначений.ToArray(таблица, "Код,Наименование");
//   </example>
// </doc>
Функция ToArray(Таблица, Колонки = "") Экспорт   //⚙
	
	ib = "Преобразование таблицы в массив структур";   //✍
	
	Результат = Новый Массив;   //✏
	
	СписокКолонок = ?(ПустаяСтрока(Колонки), ПолучитьИменаКолонок(Таблица), СтрРазделить(Колонки, ",", Ложь));   //✏
	
	Для Каждого Строка Из Таблица Цикл   //⟳
		СтруктураСтроки = Новый Структура;   //✏
		Для Каждого ИмяКолонки Из СписокКолонок Цикл   //⟳
			ИмяКолонки = СокрЛП(ИмяКолонки);   //✏
			СтруктураСтроки.Вставить(ИмяКолонки, Строка[ИмяКолонки]);   //✏
		КонецЦикла;
		Результат.Добавить(СтруктураСтроки);   //✏
	КонецЦикла;
	
	Возврат Результат;   //↩
	
КонецФункции

// <doc>
//   <summary>Получает значения указанной колонки в виде массива.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Исходная таблица</param> ➤
//   <param i="2" name="ИмяКолонки" type="String">Имя колонки</param> ➤
//   <returns>Array — массив значений колонки</returns> ⬅
//   <complexity cc="2"/>
//   <example>
//     // коды = М1сAIТаблицыЗначений.Column(таблица, "Код");
//   </example>
// </doc>
Функция Column(Таблица, ИмяКолонки) Экспорт   //⚙
	
	ib = "Получение значений колонки";   //✍
	
	Результат = Новый Массив;   //✏
	
	Для Каждого Строка Из Таблица Цикл   //⟳
		Результат.Добавить(Строка[ИмяКолонки]);   //✏
	КонецЦикла;
	
	Возврат Результат;   //↩
	
КонецФункции

// <doc>
//   <summary>Выгружает колонку таблицы в массив (алиас для Column).</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Исходная таблица</param> ➤
//   <param i="2" name="ИмяКолонки" type="String">Имя колонки для выгрузки</param> ➤
//   <returns>Array — массив значений</returns> ⬅
//   <complexity cc="1"/>
// </doc>
Функция UnloadColumn(Таблица, ИмяКолонки) Экспорт   //⚙
	
	ib = "Выгрузка колонки таблицы";   //✍
	
	Возврат Column(Таблица, ИмяКолонки);   //▶️
	
КонецФункции

// <doc>
//   <summary>Получает количество строк в таблице.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для подсчёта</param> ➤
//   <returns>Number — количество строк</returns> ⬅
//   <complexity cc="1"/>
// </doc>
Функция Count(Таблица) Экспорт   //⚙
	
	ib = "Подсчёт строк в таблице";   //✍
	
	Возврат Таблица.Количество();   //↩
	
КонецФункции

// <doc>
//   <summary>Проверяет, пуста ли таблица.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для проверки</param> ➤
//   <returns>Boolean — Истина если таблица пуста</returns> ⬅
//   <complexity cc="1"/>
// </doc>
Функция IsEmpty(Таблица) Экспорт   //⚙
	
	ib = "Проверка пустоты таблицы";   //✍
	
	Возврат Таблица.Количество() = 0;   //↩
	
КонецФункции

// <doc>
//   <summary>Очищает все строки таблицы, сохраняя структуру колонок.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для очистки</param> ➤
//   <returns>ValueTable — исходная таблица (изменяется)</returns> ⬅
//   <complexity cc="1"/>
// </doc>
Функция Clear(Таблица) Экспорт   //⚙
	
	ib = "Очистка таблицы";   //✍
	
	Таблица.Очистить();   //✏
	
	Возврат Таблица;   //↩
	
КонецФункции

// <doc>
//   <summary>Создаёт копию таблицы со всеми данными.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для копирования</param> ➤
//   <param i="2" name="Колонки" type="String">Список колонок для копирования (пусто = все)</param> ➤
//   <returns>ValueTable — новая копия таблицы</returns> ⬅
//   <complexity cc="2"/>
//   <example>
//     // копия = М1сAIТаблицыЗначений.Copy(таблица, "Код,Наименование");
//   </example>
// </doc>
Функция Copy(Таблица, Колонки = "") Экспорт   //⚙
	
	ib = "Копирование таблицы";   //✍
	
	Если ПустаяСтрока(Колонки) Тогда   //⚡
		Возврат Таблица.Скопировать();   //↩
	Иначе
		Возврат Таблица.Скопировать(, Колонки);   //↩
	КонецЕсли;
	
КонецФункции

// <doc>
//   <summary>Группирует таблицу по указанным колонкам с агрегацией.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Исходная таблица</param> ➤
//   <param i="2" name="КолонкиГруппировки" type="String">Колонки для группировки через запятую</param> ➤
//   <param i="3" name="КолонкиСуммирования" type="String">Колонки для суммирования через запятую</param> ➤
//   <returns>ValueTable — новая сгруппированная таблица</returns> ⬅
//   <complexity cc="2"/>
//   <example>
//     // итоги = М1сAIТаблицыЗначений.GroupBy(продажи, "Товар", "Количество,Сумма");
//   </example>
// </doc>
Функция GroupBy(Таблица, КолонкиГруппировки, КолонкиСуммирования = "") Экспорт   //⚙
	
	ib = "Группировка таблицы";   //✍
	
	Если ПустаяСтрока(КолонкиСуммирования) Тогда   //⚡
		Возврат Таблица.Скопировать(, КолонкиГруппировки);   //↩
	Иначе
		Результат = Таблица.Скопировать();   //✏
		Результат.Свернуть(КолонкиГруппировки, КолонкиСуммирования);   //✏
		Возврат Результат;   //↩
	КонецЕсли;
	
КонецФункции

// <doc>
//   <summary>Получает список имён всех колонок таблицы.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для анализа</param> ➤
//   <returns>Array — массив имён колонок</returns> ⬅
//   <complexity cc="2"/>
// </doc>
Функция GetColumnNames(Таблица) Экспорт   //⚙
	
	ib = "Получение имён колонок";   //✍
	
	Результат = Новый Массив;   //✏
	
	Для Каждого Колонка Из Таблица.Колонки Цикл   //⟳
		Результат.Добавить(Колонка.Имя);   //✏
	КонецЦикла;
	
	Возврат Результат;   //↩
	
КонецФункции

// <doc>
//   <summary>Проверяет наличие колонки в таблице.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для проверки</param> ➤
//   <param i="2" name="ИмяКолонки" type="String">Имя искомой колонки</param> ➤
//   <returns>Boolean — Истина если колонка существует</returns> ⬅
//   <complexity cc="1"/>
// </doc>
Функция HasColumn(Таблица, ИмяКолонки) Экспорт   //⚙
	
	ib = "Проверка наличия колонки";   //✍
	
	Возврат Таблица.Колонки.Найти(ИмяКолонки) <> Неопределено;   //↩
	
КонецФункции

// <doc>
//   <summary>Удаляет строки таблицы по условию.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для удаления</param> ➤
//   <param i="2" name="КолонкиИЗначения" type="Structure">Условие поиска строк для удаления</param> ➤
//   <returns>Number — количество удалённых строк</returns> ⬅
//   <complexity cc="2"/>
//   <example>
//     // М1сAIТаблицыЗначений.DeleteRows(таблица, М1сAIСтруктуры.Of("Удалён", Истина));
//   </example>
// </doc>
Функция DeleteRows(Таблица, КолонкиИЗначения) Экспорт   //⚙
	
	ib = "Удаление строк по условию";   //✍
	
	НайденныеСтроки = Таблица.НайтиСтроки(КолонкиИЗначения);   //✏
	Счетчик = НайденныеСтроки.Количество();   //✏
	
	Для Каждого Строка Из НайденныеСтроки Цикл   //⟳
		Таблица.Удалить(Строка);   //✏
	КонецЦикла;
	
	Возврат Счетчик;   //↩
	
КонецФункции

// <doc>
//   <summary>Создаёт индекс для быстрого поиска по колонкам.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для индексирования</param> ➤
//   <param i="2" name="Колонки" type="String">Колонки индекса через запятую</param> ➤
//   <returns>ValueTable — исходная таблица с созданным индексом</returns> ⬅
//   <complexity cc="1"/>
// </doc>
Функция CreateIndex(Таблица, Колонки) Экспорт   //⚙
	
	ib = "Создание индекса таблицы";   //✍
	
	Таблица.Индексы.Добавить(Колонки);   //✏
	
	Возврат Таблица;   //↩
	
КонецФункции

// <doc>
//   <summary>Объединяет строки из нескольких таблиц в одну (Union All).</summary> ✦
//   <param i="1" name="ЦелеваяТаблица" type="ValueTable">Таблица-приёмник</param> ➤
//   <param i="2" name="ДобавляемыеТаблицы" type="Array">Массив таблиц для объединения</param> ➤
//   <returns>ValueTable — целевая таблица с добавленными строками</returns> ⬅
//   <complexity cc="3"/>
// </doc>
Функция Union(ЦелеваяТаблица, ДобавляемыеТаблицы) Экспорт   //⚙
	
	ib = "Объединение таблиц";   //✍
	
	Для Каждого Таблица Из ДобавляемыеТаблицы Цикл   //⟳
		Для Каждого Строка Из Таблица Цикл   //⟳
			ЗаполнитьЗначенияСвойств(ЦелеваяТаблица.Добавить(), Строка);   //✏
		КонецЦикла;
	КонецЦикла;
	
	Возврат ЦелеваяТаблица;   //↩
	
КонецФункции

// <doc>
//   <summary>Применяет функцию-обработчик к каждой строке таблицы.</summary> ✦
//   <param i="1" name="Таблица" type="ValueTable">Таблица для обработки</param> ➤
//   <param i="2" name="Обработчик" type="String">Имя процедуры обработчика вида: Процедура(Строка)</param> ➤
//   <returns>ValueTable — исходная таблица (изменяется)</returns> ⬅
//   <complexity cc="2"/>
//   <remark>Обработчик должен принимать один параметр - строку таблицы</remark>
// </doc>
Функция ForEach(Таблица, Обработчик) Экспорт   //⚙
	
	ib = "Применение обработчика к строкам";   //✍
	
	Для Каждого Строка Из Таблица Цикл   //⟳
		Выполнить(Обработчик + "(Строка)");   //▶️
	КонецЦикла;
	
	Возврат Таблица;   //↩
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Добавляет колонки в таблицу из строкового описания
// Параметры:
//   Таблица - ТаблицаЗначений - целевая таблица
//   СтрокаОписания - Строка - описание вида "Колонка1:Тип1,Колонка2:Тип2"
//
Процедура ДобавитьКолонкиИзСтроки(Таблица, СтрокаОписания)   //✍
	
	МассивКолонок = СтрРазделить(СтрокаОписания, ",", Ложь);   //✏
	
	Для Каждого ОписаниеКолонки Из МассивКолонок Цикл   //⟳
		ОписаниеКолонки = СокрЛП(ОписаниеКолонки);   //✏
		
		Если СтрНайти(ОписаниеКолонки, ":") > 0 Тогда   //⚡
			ЧастиОписания = СтрРазделить(ОписаниеКолонки, ":", Ложь);   //✏
			ИмяКолонки = СокрЛП(ЧастиОписания[0]);   //✏
			ИмяТипа = СокрЛП(ЧастиОписания[1]);   //✏
			ТипКолонки = ПолучитьТипПоИмени(ИмяТипа);   //▶️
			Таблица.Колонки.Добавить(ИмяКолонки, ТипКолонки);   //✏
		Иначе
			Таблица.Колонки.Добавить(ОписаниеКолонки);   //✏
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Добавляет колонки в таблицу из структуры
// Параметры:
//   Таблица - ТаблицаЗначений - целевая таблица
//   Структура - Структура - структура вида {ИмяКолонки: "ИмяТипа"}
//
Процедура ДобавитьКолонкиИзСтруктуры(Таблица, Структура)   //✍
	
	Для Каждого КлючЗначение Из Структура Цикл   //⟳
		ИмяКолонки = КлючЗначение.Ключ;   //✏
		
		Если ТипЗнч(КлючЗначение.Значение) = Тип("Строка") Тогда   //⚡
			ТипКолонки = ПолучитьТипПоИмени(КлючЗначение.Значение);   //▶️
			Таблица.Колонки.Добавить(ИмяКолонки, ТипКолонки);   //✏
		ИначеЕсли ТипЗнч(КлючЗначение.Значение) = Тип("ОписаниеТипов") Тогда   //⚡
			Таблица.Колонки.Добавить(ИмяКолонки, КлючЗначение.Значение);   //✏
		Иначе
			Таблица.Колонки.Добавить(ИмяКолонки);   //✏
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Добавляет строку в таблицу с заполнением значений
// Параметры:
//   Таблица - ТаблицаЗначений - целевая таблица
//   ДанныеСтроки - Структура, Массив - данные для заполнения
//
Процедура ДобавитьСтрокуВТаблицу(Таблица, ДанныеСтроки)   //✍
	
	НоваяСтрока = Таблица.Добавить();   //✏
	
	Если ТипЗнч(ДанныеСтроки) = Тип("Структура") Тогда   //⚡
		ЗаполнитьЗначенияСвойств(НоваяСтрока, ДанныеСтроки);   //✏
	ИначеЕсли ТипЗнч(ДанныеСтроки) = Тип("Массив") Тогда   //⚡
		ЗаполнитьСтрокуИзМассива(НоваяСтрока, ДанныеСтроки);   //▶️
	КонецЕсли;
	
КонецПроцедуры

// Заполняет строку таблицы значениями из массива по порядку
// Параметры:
//   Строка - СтрокаТаблицыЗначений - заполняемая строка
//   МассивЗначений - Массив - массив значений
//
Процедура ЗаполнитьСтрокуИзМассива(Строка, МассивЗначений)   //✍
	
	Владелец = Строка.Владелец();   //✏
	Индекс = 0;   //✏
	
	Для Каждого Колонка Из Владелец.Колонки Цикл   //⟳
		Если Индекс < МассивЗначений.Количество() Тогда   //⚡
			Строка[Колонка.Имя] = МассивЗначений[Индекс];   //✏
			Индекс = Индекс + 1;   //✏
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

// Возвращает описание типа по его имени
// Параметры:
//   ИмяТипа - Строка - имя типа (Строка, Число, Дата и т.д.)
// Возвращаемое значение:
//   ОписаниеТипов - описание типа
//
Функция ПолучитьТипПоИмени(ИмяТипа)   //✍
	
	ИмяТипа = ВРег(СокрЛП(ИмяТипа));   //✏
	
	Если ИмяТипа = "СТРОКА" ИЛИ ИмяТипа = "STRING" Тогда   //⚡
		Возврат Новый ОписаниеТипов("Строка");   //↩
	ИначеЕсли ИмяТипа = "ЧИСЛО" ИЛИ ИмяТипа = "NUMBER" Тогда   //⚡
		Возврат Новый ОписаниеТипов("Число");   //↩
	ИначеЕсли ИмяТипа = "ДАТА" ИЛИ ИмяТипа = "DATE" Тогда   //⚡
		Возврат Новый ОписаниеТипов("Дата");   //↩
	ИначеЕсли ИмяТипа = "БУЛЕВО" ИЛИ ИмяТипа = "BOOLEAN" Тогда   //⚡
		Возврат Новый ОписаниеТипов("Булево");   //↩
	Иначе
		// Пробуем создать тип по переданному имени
		Попытка   //⚡
			Возврат Новый ОписаниеТипов(ИмяТипа);   //↩
		Исключение
			Возврат Новый ОписаниеТипов;   //↩
		КонецПопытки;
	КонецЕсли;
	
КонецФункции

// Получает массив имён колонок таблицы
// Параметры:
//   Таблица - ТаблицаЗначений
// Возвращаемое значение:
//   Массив - массив строк с именами колонок
//
Функция ПолучитьИменаКолонок(Таблица)   //✍
	
	Результат = Новый Массив;   //✏
	
	Для Каждого Колонка Из Таблица.Колонки Цикл   //⟳
		Результат.Добавить(Колонка.Имя);   //✏
	КонецЦикла;
	
	Возврат Результат;   //↩
	
КонецФункции

// Преобразует таблицу в массив строк
// Параметры:
//   Таблица - ТаблицаЗначений
// Возвращаемое значение:
//   Массив - массив строк таблицы
//
Функция ТаблицаВМассив(Таблица)   //✍
	
	Результат = Новый Массив;   //✏
	
	Для Каждого Строка Из Таблица Цикл   //⟳
		Результат.Добавить(Строка);   //✏
	КонецЦикла;
	
	Возврат Результат;   //↩
	
КонецФункции

#КонецОбласти

#Область Тестирование

// <doc>
// <summary>Выполняет автоматическое тестирование всех функций модуля М1сAIТаблицыЗначений.</summary> ✦
// <returns>Boolean — Истина если все тесты прошли успешно</returns> ⬅
// <complexity cc="15"/>
// </doc>
Функция SelfTest() Экспорт   //⚙
	
	ib = "Автоматическое тестирование М1сAIТаблицыЗначений";   //✍
	
	TestsTotal = 0;   //✏
	TestsPassed = 0;   //✏
	
	Сообщить("=== Запуск тестирования М1сAIТаблицыЗначений ===");
	
	// Тест 1: Создание таблицы из строки с типами
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		Таб1 = Of("Код:Строка,Наименование:Строка,Цена:Число");   //▶️
		Если Count(Таб1) = 0 И HasColumn(Таб1, "Код") И HasColumn(Таб1, "Цена") Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 1 (Of с типами): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 1 (Of с типами): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 1 (Of с типами): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 2: Добавление строк
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		Таб2 = OfColumns("Товар,Количество:Число");   //▶️
		AddRow(Таб2, Новый Структура("Товар,Количество", "Молоко", 5));   //▶️
		МассивЗначений = Новый Массив;   //✏
		МассивЗначений.Добавить("Хлеб");   //✏
		МассивЗначений.Добавить(3);   //✏
		AddRow(Таб2, МассивЗначений);   //▶️
		Если Count(Таб2) = 2 Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 2 (AddRow): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 2 (AddRow): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 2 (AddRow): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 3: Поиск строки
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		НайденнаяСтрока = FindRow(Таб2, Новый Структура("Товар", "Молоко"));   //▶️
		Если НайденнаяСтрока <> Неопределено И НайденнаяСтрока.Количество = 5 Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 3 (Find): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 3 (Find): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 3 (Find): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 4: Получение колонки
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		КолонкаТоваров = Column(Таб2, "Товар");   //▶️
		Если КолонкаТоваров.Количество() = 2 И КолонкаТоваров[0] = "Молоко" Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 4 (Column): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 4 (Column): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 4 (Column): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 5: ToArray
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		МассивСтруктур = ToArray(Таб2);   //▶️
		Если МассивСтруктур.Количество() = 2 И ТипЗнч(МассивСтруктур[0]) = Тип("Структура") Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 5 (ToArray): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 5 (ToArray): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 5 (ToArray): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 6: Sort
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		Sort(Таб2, "Товар");   //▶️
		Если Таб2[0].Товар = "Молоко" ИЛИ Таб2[0].Товар = "Хлеб" Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 6 (Sort): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 6 (Sort): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 6 (Sort): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 7: Copy
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		Копия = Copy(Таб2);   //▶️
		Если Count(Копия) = Count(Таб2) Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 7 (Copy): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 7 (Copy): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 7 (Copy): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 8: IsEmpty и Clear
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		ПустаяТаблица = OfColumns("Тест");   //▶️
		Если IsEmpty(ПустаяТаблица) Тогда   //⚡
			AddRow(ПустаяТаблица, Новый Структура("Тест", "Значение"));   //▶️
			Clear(ПустаяТаблица);   //▶️
			Если IsEmpty(ПустаяТаблица) Тогда   //⚡
				TestsPassed = TestsPassed + 1;   //✏
				Сообщить("✓ Тест 8 (IsEmpty/Clear): ПРОЙДЕН");
			Иначе
				Сообщить("✗ Тест 8 (IsEmpty/Clear): ПРОВАЛЕН");
			КонецЕсли;
		Иначе
			Сообщить("✗ Тест 8 (IsEmpty/Clear): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 8 (IsEmpty/Clear): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 9: GetColumnNames
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		ИменаКолонок = GetColumnNames(Таб2);   //▶️
		Если ИменаКолонок.Количество() = 2 Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 9 (GetColumnNames): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 9 (GetColumnNames): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 9 (GetColumnNames): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Тест 10: DeleteRows
	TestsTotal = TestsTotal + 1;   //✏
	Попытка   //⚡
		ТаблицаДляУдаления = Copy(Таб2);   //▶️
		Удалено = DeleteRows(ТаблицаДляУдаления, Новый Структура("Товар", "Хлеб"));   //▶️
		Если Удалено >= 1 И Count(ТаблицаДляУдаления) < Count(Таб2) Тогда   //⚡
			TestsPassed = TestsPassed + 1;   //✏
			Сообщить("✓ Тест 10 (DeleteRows): ПРОЙДЕН");
		Иначе
			Сообщить("✗ Тест 10 (DeleteRows): ПРОВАЛЕН");
		КонецЕсли;
	Исключение
		Сообщить("✗ Тест 10 (DeleteRows): ОШИБКА - " + ОписаниеОшибки());
	КонецПопытки;
	
	// Итоги тестирования
	Если TestsPassed = TestsTotal Тогда   //⚡
		Сообщить("=== М1сAIТаблицыЗначений.SelfTest() SUCCESS: " + Строка(TestsPassed) + "/" + Строка(TestsTotal) + " ===");
		Возврат Истина;   //↩
	Иначе
		Сообщить("=== М1сAIТаблицыЗначений.SelfTest() FAILED: " + Строка(TestsPassed) + "/" + Строка(TestsTotal) + " ===");
		Возврат Ложь;   //↩
	КонецЕсли;
	
КонецФункции

// <doc>
// <summary>Демонстрирует расширенные примеры использования модуля М1сAIТаблицыЗначений.</summary> ✦
// </doc>
Процедура ExamplesAdvanced() Экспорт   //⚙
	
	ib = "Примеры использования М1сAIТаблицыЗначений";   //✍
	
	Сообщить("=== Расширенные примеры М1сAIТаблицыЗначений ===");
	
	// Пример 1: Создание справочника товаров
	Товары = Of("Код:Строка,Наименование:Строка,Цена:Число,Активен:Булево");   //▶️
	AddRow(Товары, Новый Структура("Код,Наименование,Цена,Активен", "001", "Молоко", 75.50, Истина));   //▶️
	AddRow(Товары, Новый Структура("Код,Наименование,Цена,Активен", "002", "Хлеб", 45.00, Истина));   //▶️
	AddRow(Товары, Новый Структура("Код,Наименование,Цена,Активен", "003", "Масло", 120.00, Ложь));   //▶️
	Сообщить("Создан справочник товаров: " + Строка(Count(Товары)) + " позиций");
	
	// Пример 2: Фильтрация активных товаров
	АктивныеТовары = Filter(Товары, Новый Структура("Активен", Истина));   //▶️
	Сообщить("Активных товаров: " + Строка(АктивныеТовары.Количество()));
	
	// Пример 3: Сортировка по цене
	Sort(Товары, "Цена Убыв");   //▶️
	Сообщить("Самый дорогой товар: " + Товары[0].Наименование + " - " + Строка(Товары[0].Цена) + " руб.");
	
	// Пример 4: Получение списка кодов
	КодыТоваров = Column(Товары, "Код");   //▶️
	Сообщить("Коды товаров: " + СтрСоединить(КодыТоваров, ", "));
	
	// Пример 5: Создание таблицы продаж и группировка
	Продажи = Of("Дата:Дата,Товар:Строка,Количество:Число,Сумма:Число");   //▶️
	AddRow(Продажи, Новый Структура("Дата,Товар,Количество,Сумма", ТекущаяДата(), "Молоко", 10, 755));   //▶️
	AddRow(Продажи, Новый Структура("Дата,Товар,Количество,Сумма", ТекущаяДата(), "Хлеб", 5, 225));   //▶️
	AddRow(Продажи, Новый Структура("Дата,Товар,Количество,Сумма", ТекущаяДата(), "Молоко", 3, 226.50));   //▶️
	
	ИтогиПоТоварам = GroupBy(Продажи, "Товар", "Количество,Сумма");   //▶️
	Сообщить("Итоги по товарам:");
	Для Каждого Строка Из ИтогиПоТоварам Цикл   //⟳
		Сообщить("  " + Строка.Товар + ": " + Строка.Количество + " шт. на сумму " + Строка.Сумма + " руб.");
	КонецЦикла;
	
	// Пример 6: Преобразование в массив структур для JSON
	МассивДанных = ToArray(Товары, "Код,Наименование,Цена");   //▶️
	Сообщить("Преобразовано в массив: " + Строка(МассивДанных.Количество()) + " записей");
	
	// Пример 7: Создание индекса для быстрого поиска
	CreateIndex(Товары, "Код");   //▶️
	НайденныйТовар = FindRow(Товары, Новый Структура("Код", "001"));   //▶️
	Если НайденныйТовар <> Неопределено Тогда   //⚡
		Сообщить("Быстрый поиск по индексу: " + НайденныйТовар.Наименование);
	КонецЕсли;
	
	Сообщить("=== Примеры завершены ===");
	
КонецПроцедуры

#КонецОбласти

// <doc>
// <summary>Возвращает версию модуля М1сAIТаблицыЗначений.</summary> ✦
// <returns>String — версия модуля</returns> ⬅
// <complexity cc="1"/>
// </doc>
Функция GetVersion() Экспорт   //⚙
	ib = "Получение версии модуля";   //✍
	Возврат "1.0.0";   //↩
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// МОДУЛЬ ЗАВЕРШЕН - М1сAIТаблицыЗначений v1.0.0
// Готов к производственному использованию!
// 
// Основные возможности:
// - Создание таблиц: Of(), OfColumns()
// - Работа со строками: AddRow(), AddRows(), DeleteRows()
// - Поиск и фильтрация: Find(), Filter()
// - Сортировка и группировка: Sort(), GroupBy()
// - Преобразования: ToArray(), Column(), UnloadColumn()
// - Утилиты: Count(), IsEmpty(), Clear(), Copy(), HasColumn()
// - Операции: Union(), CreateIndex(), ForEach()
//
// Полностью совместим со стандартами разработки:
// ✅ XML-документация для всех функций
// ✅ SyntaxMarks для всех конструкций
// ✅ Комплексное тестирование
// ✅ Продвинутые примеры использования
//
// Интеграция с другими модулями:
// - Используется с М1сAIСтруктуры для создания структур данных
// - Используется с М1сAIМассивы для работы с массивами
//
// Примеры оптимизации кода:
//
// БЫЛО (без М1сAIТаблицыЗначений):
// Таблица = Новый ТаблицаЗначений;
// Таблица.Колонки.Добавить("ТипЕГАИС", Новый ОписаниеТипов("Строка"));
// Таблица.Колонки.Добавить("URLДокумента", Новый ОписаниеТипов("Строка"));
// НоваяСтрока = Таблица.Добавить();
// НоваяСтрока.ТипЕГАИС = "WayBillAct";
// НоваяСтрока.URLДокумента = "http://...";
//
// СТАЛО (с М1сAIТаблицыЗначений):
// Таблица = М1сAIТаблицыЗначений.Of("ТипЕГАИС,URLДокумента");
// М1сAIТаблицыЗначений.AddRow(Таблица, М1сAIСтруктуры.Of("ТипЕГАИС", "WayBillAct", "URLДокумента", "http://..."));
//
// ИЛИ ещё короче:
// Таблица = М1сAIТаблицыЗначений.Of("ТипЕГАИС,URLДокумента", 
//     М1сAIМассивы.Of(
//         М1сAIСтруктуры.Of("ТипЕГАИС", "WayBillAct", "URLДокумента", "http://...")
//     )
// );
//
// Лицензия: MIT
////////////////////////////////////////////////////////////////////////////////
